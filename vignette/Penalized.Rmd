---
title: "Penalized: An R package for time series"
author: "Andrea Storey"
output: pdf_document
date: "2025-08-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
```
## Introduction to the package PenalizedCorr

The PenalizedCorr package introduces a new object called 'penalized'.
The arguments used in this Package are:

+ **x** - a univariate or multivariate numeric time series object or a numeric vector or matrix.
+ **lag.max** - maximum lag at which to calculate the ACF/PACF. Defaults to the smaller of eqn{N-1} and eqn{10log_{10}(N/nser)} where N is the number of non-missing observations and nser is the number of series.
+ **type** - character string giving the type of acf to be computed. Allowed values are "correlation" (the default), "covariance" or "partial". Will be partially matched.
+ **plot** - logical. If TRUE (the default) the ACF/PACF is plotted.
+ **na.action** - function to be called to handle missing values. code{na.pass} can be used.
+ **demean** - logical. Should a mean be estimated and subtracted before correlations are calculated?
+ **penalized** - penalized logical. If TRUE (the default) the penalized ACF/PACF is computed; if FALSE the sample ACF/PACF is computed using stats:acf.
+ **lh** - sequence of threshold values across h, default is NULL. Could be a single value (repeated for all h), a single vector of length lag.max (repeated for all nser), or a h x nser matrix. Default is data driven choice.
+ **estimate** - character vector of the estimation method for the ACF, options are "direct" (default) or "invertpacf".  "invertpacf" is preferred when the data can be approximated by a low order AR model.
+ **lambda** - controls the degree of shrinkage towards the target.
+ **target** - the unbiased (partial) autocorrelation function from a (model) assumption.


## Example: use of parameter penalized

In the current statistics acf and pacf the parameters are x, lag.max = NULL, type = c("correlation", "covariance", "partial"), plot = TRUE, na.action = na.fail, demean = TRUE. These parameters are the same and work the same in this package but we also introduce new parameters.
The penalized M-estimator for (partial) autocorrelation, with the penalty pushing the estimator toward a target selected from the data.

When using the PenalizedCorr package we will use a parameter penalized. If TRUE (the default) the parameter penalized ACF/PACF is computed; if FALSE the sample ACF/PACF is computed using stats:acf.

This can be shown below where we first need to simulate time series data (ts), which we'll call timeseries of length 100 from an AR(1) model with an auto regressive coefficient of 0.5. Then we can show time series with default penalized but you can also use penalized=TRUE.

```{r}
library("PenalizedCorr")
set.seed(123)
timeseries <- arima.sim(n=100, model=list(ar=0.5))
acf(timeseries)
print(acf(timeseries))

pacf(timeseries)
print(pacf(timeseries))
```

You can also put penalized in your code
```{r}
pacf(timeseries, penalized =  TRUE)
```

The plot is a default TRUE setting so if you don't want a plot then use,
```{r}
acf(timeseries, plot=FALSE)
```
We can do the same for pacf.

To see the usual stats::acf() implementation we can do penalized=FALSE as shown below.
```{r}
acf(timeseries, penalized=FALSE)
print(acf(timeseries, penalized=FALSE))

pacf(timeseries, penalized=FALSE)
print(pacf(timeseries, penalized=FALSE))
```

## Example: use of parameter lambda and or target

We provide data-driven target and tuning parameters which improve estimation of the ACF and PACF in finite samples and the limit.

Lambda controls the degree of shrinkage towards the target.

Target is the unbiased (partial) autocorrelation function from a (model) assumption

An example use of lambda.
```{r}
acf(timeseries, lambda = 3) #lambda can only be a positive number
```

An example use of target.
```{r}
acf(timeseries, target = -1) #target can only be between -1 and 1
```
An example of both lambda and target together.
```{r}
acf(timeseries, lambda = 3, target = -1)
```

## Example of acf using all parameters at same time. The below will use the defualts for all parameters.
```{r}
acf(timeseries, lag.max=NULL, type=c("correlation"), plot=TRUE, na.action=na.fail, 
demean=TRUE, penalized=TRUE, lh=NULL, estimate="direct", lambda=NULL, target=NULL)
```
